<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ketil B., Laurits H., Herman E. og Theodor S.">
<meta name="dcterms.date" content="2025-11-07">

<title>Arbeidskrav 4: Kausal interferens</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Arbeidskrav4_files/libs/clipboard/clipboard.min.js"></script>
<script src="Arbeidskrav4_files/libs/quarto-html/quarto.js"></script>
<script src="Arbeidskrav4_files/libs/quarto-html/popper.min.js"></script>
<script src="Arbeidskrav4_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Arbeidskrav4_files/libs/quarto-html/anchor.min.js"></script>
<link href="Arbeidskrav4_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Arbeidskrav4_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Arbeidskrav4_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Arbeidskrav4_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Arbeidskrav4_files/libs/bootstrap/bootstrap-c0367b04c37547644fece4185067e4a7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Innhold</h2>
   
  <ul>
  <li><a href="#definisjon-av-en-kasual-effekt" id="toc-definisjon-av-en-kasual-effekt" class="nav-link active" data-scroll-target="#definisjon-av-en-kasual-effekt"><span class="header-section-number">1</span> Definisjon av en kasual effekt</a></li>
  <li><a href="#hvordan-kan-vi-bruke-en-eksperimentell-studie-for-å-estimere-en-kausal-effekt" id="toc-hvordan-kan-vi-bruke-en-eksperimentell-studie-for-å-estimere-en-kausal-effekt" class="nav-link" data-scroll-target="#hvordan-kan-vi-bruke-en-eksperimentell-studie-for-å-estimere-en-kausal-effekt"><span class="header-section-number">2</span> Hvordan kan vi bruke en eksperimentell studie for å estimere en kausal effekt?</a></li>
  <li><a href="#hvordan-kan-vi-bruke-en-observasjonsstudier-for-å-estimere-en-kausal-effekt" id="toc-hvordan-kan-vi-bruke-en-observasjonsstudier-for-å-estimere-en-kausal-effekt" class="nav-link" data-scroll-target="#hvordan-kan-vi-bruke-en-observasjonsstudier-for-å-estimere-en-kausal-effekt"><span class="header-section-number">3</span> Hvordan kan vi bruke en observasjonsstudier for å estimere en kausal effekt?</a></li>
  <li><a href="#hva-er-en-konfunderende-effekt" id="toc-hva-er-en-konfunderende-effekt" class="nav-link" data-scroll-target="#hva-er-en-konfunderende-effekt"><span class="header-section-number">4</span> Hva er en konfunderende effekt?</a></li>
  <li><a href="#beskriv-effekten-av-å-kontrollere-for-en-variabel-som-påvirkes-av-en-intervensjon-når-vi-ønsker-å-estimere-effekten-av-intervensjonen-på-en-annen-variabel." id="toc-beskriv-effekten-av-å-kontrollere-for-en-variabel-som-påvirkes-av-en-intervensjon-når-vi-ønsker-å-estimere-effekten-av-intervensjonen-på-en-annen-variabel." class="nav-link" data-scroll-target="#beskriv-effekten-av-å-kontrollere-for-en-variabel-som-påvirkes-av-en-intervensjon-når-vi-ønsker-å-estimere-effekten-av-intervensjonen-på-en-annen-variabel."><span class="header-section-number">5</span> Beskriv effekten av å kontrollere for en variabel som påvirkes av en intervensjon når vi ønsker å estimere effekten av intervensjonen på en annen variabel.</a></li>
  <li><a href="#beskriv-effekten-av-å-kontrollere-for-en-variabel-som-påvirkes-av-utfall-og-avhengig-variabel-i-en-regresjonsanalyse-en-collider." id="toc-beskriv-effekten-av-å-kontrollere-for-en-variabel-som-påvirkes-av-utfall-og-avhengig-variabel-i-en-regresjonsanalyse-en-collider." class="nav-link" data-scroll-target="#beskriv-effekten-av-å-kontrollere-for-en-variabel-som-påvirkes-av-utfall-og-avhengig-variabel-i-en-regresjonsanalyse-en-collider."><span class="header-section-number">6</span> Beskriv effekten av å kontrollere for en variabel som påvirkes av utfall og avhengig variabel i en regresjonsanalyse (en collider).</a></li>
  <li><a href="#beskriv-ved-hjelp-av-en-grafisk-modell-directed-acyclic-graph-en-positiv-sammenheng-mellom-konsumpsjon-av-sukkerfri-brus-og-diabetes.-begrense-antall-variabler-til-4-og-begrunn-din-modell." id="toc-beskriv-ved-hjelp-av-en-grafisk-modell-directed-acyclic-graph-en-positiv-sammenheng-mellom-konsumpsjon-av-sukkerfri-brus-og-diabetes.-begrense-antall-variabler-til-4-og-begrunn-din-modell." class="nav-link" data-scroll-target="#beskriv-ved-hjelp-av-en-grafisk-modell-directed-acyclic-graph-en-positiv-sammenheng-mellom-konsumpsjon-av-sukkerfri-brus-og-diabetes.-begrense-antall-variabler-til-4-og-begrunn-din-modell."><span class="header-section-number">7</span> Beskriv ved hjelp av en grafisk modell (Directed Acyclic Graph) en positiv sammenheng mellom konsumpsjon av sukkerfri brus og diabetes. Begrense antall variabler til &lt; 4 og begrunn din modell.</a></li>
  <li><a href="#referanseliste" id="toc-referanseliste" class="nav-link" data-scroll-target="#referanseliste"><span class="header-section-number">8</span> Referanseliste</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Arbeidskrav 4: Kausal interferens</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ketil B., Laurits H., Herman E. og Theodor S. </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 7, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="definisjon-av-en-kasual-effekt" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="definisjon-av-en-kasual-effekt"><span class="header-section-number">1</span> Definisjon av en kasual effekt</h2>
<p>Kausal effekt kan defineres som forskjellen på utfallene en person ville opplevd dersom en ble gitt ulike behandlinger. Eksempelvis beskriver Council et al (2000) utfallet ved å sammenlikne en eksperimentell behandling (E), kontra kontroll (C). For hver observasjon som gjøres kan behandlingen kun gi et utfall. Får personen behandling C, blir utfallet C, og motsatt. Rubin (1976), Rosenbaum og Rubin (1983) og Holland (1986), referert i Council et al (2000) utviklet Rubin-Rosenbaum-Holland (RRH)-teorien for kausal effekt. Vi tar dette som utgangspunkt for å svare på definisjonen. I RRH er det forskjellen mellom utfallene hos en person ved E, og C som definerer kausal effekten. For eksempel om vi skulle ønske å finne ut om fysisk aktivitet i form av å gå turer for utrente kan redusere blodtrykk, har vi en gruppe som utfører E, mens gruppe C fortsetter som normalt. Kausal effekten i denne sammenhengen vil være forskjellen på målingen av blodtrykket. Dersom endring er oppstått, vil vi kunne konkludere at E gir en kausal effekt.</p>
</section>
<section id="hvordan-kan-vi-bruke-en-eksperimentell-studie-for-å-estimere-en-kausal-effekt" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="hvordan-kan-vi-bruke-en-eksperimentell-studie-for-å-estimere-en-kausal-effekt"><span class="header-section-number">2</span> Hvordan kan vi bruke en eksperimentell studie for å estimere en kausal effekt?</h2>
<p>Shadish et al (2002), i likhet med Council et al (2000) beskriver randomiserte eksperimentelle studier som den mest pålitelige metoden, altså gullstandarden for å estimere kausal effekt. Dette gjøres ved at behandlingene blir tilfeldig fordelt, slik at resultatet har en direkte sammenheng av behandlingen, ettersom andre faktorer ikke spiller inn (Council et al., 2000). Eksempelvis kunne vi testet en ny trenings-pille, hvor gruppe E fikk pillen, mens gruppe C fikk et placebo (beskrivelsen for E og C står i svaret over). I slutten av måleperioden kan vi gjøre en sluttmåling, hvor vi vurderer effekten av treningspillen. Shadish et al (2002) har tre hovedprinsipper for en eksperimentell studie. 1) For å finne ut av kausal effekten blir målingene utført jevnt over en tidsperiode, vi finner 2) en sammenheng mellom årsak og virkning, og at 3) muligheten for alternative forklaringer må bli utelukket.</p>
</section>
<section id="hvordan-kan-vi-bruke-en-observasjonsstudier-for-å-estimere-en-kausal-effekt" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="hvordan-kan-vi-bruke-en-observasjonsstudier-for-å-estimere-en-kausal-effekt"><span class="header-section-number">3</span> Hvordan kan vi bruke en observasjonsstudier for å estimere en kausal effekt?</h2>
<p>Det vanskelig å påvise en kausal effekt (altså at A <em>forårsaker</em> B) med en observasjonsstudiet fordi vi ikke kontrollerer for hvem som blir eksponert for hva (slik vi gjør i et RCT). Utfordringen er at sammenhenger ofte kan skyldes konfunderende faktorer som påvirker både eksponering og utfall. For å nærme seg kausalitet og estimere den kausale effekten, kan man kontrollere for slike konfundere ved hjelp av randomisering, regresjonsanalyse, matching eller stratifisering.</p>
</section>
<section id="hva-er-en-konfunderende-effekt" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="hva-er-en-konfunderende-effekt"><span class="header-section-number">4</span> Hva er en konfunderende effekt?</h2>
<p>En konfunderende effekt oppstår når sammenhengen mellom en eksponering og et utfall blandes sammen med effekten av en tredje variabel, som kalles en konfunderende variabel. En konfunder påvirker både eksponeringen og utfallet, men ligger ikke i årsakskjeden mellom dem.</p>
</section>
<section id="beskriv-effekten-av-å-kontrollere-for-en-variabel-som-påvirkes-av-en-intervensjon-når-vi-ønsker-å-estimere-effekten-av-intervensjonen-på-en-annen-variabel." class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="beskriv-effekten-av-å-kontrollere-for-en-variabel-som-påvirkes-av-en-intervensjon-når-vi-ønsker-å-estimere-effekten-av-intervensjonen-på-en-annen-variabel."><span class="header-section-number">5</span> Beskriv effekten av å kontrollere for en variabel som påvirkes av en intervensjon når vi ønsker å estimere effekten av intervensjonen på en annen variabel.</h2>
<p>Aalen og Stensrud (2020) forteller oss at ofte har intervensjoner en indirekte effekt på utfallsvariabelen, via mediatorer. Med andre ord, så påvirker intervensjonen en variabel (mediatoren), som igjen påvirker utfallsvariabelen. Man kontrollerer for mediatorer når når man ønsker å undersøke den direkte effekten av intervensjonen på utfallet.</p>
<p>Et eksempel på dette vil være følgende: En medisin (intervensjonen) er lagd for å redusere risikoen for kardiovaskulær sykdom (utfallet) via reduksjon av blodtrykket (mediatoren).</p>
<p>Det er viktig å merke at å kontrollere for en mediator kan være risikabelt, siden du reduserer den totale effekten av intervensjonen. Dermed er det i utgangspunktet ikke anbefalt å kontrollere for mediatorer (Digitale et al., 2022)</p>
</section>
<section id="beskriv-effekten-av-å-kontrollere-for-en-variabel-som-påvirkes-av-utfall-og-avhengig-variabel-i-en-regresjonsanalyse-en-collider." class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="beskriv-effekten-av-å-kontrollere-for-en-variabel-som-påvirkes-av-utfall-og-avhengig-variabel-i-en-regresjonsanalyse-en-collider."><span class="header-section-number">6</span> Beskriv effekten av å kontrollere for en variabel som påvirkes av utfall og avhengig variabel i en regresjonsanalyse (en collider).</h2>
<p>I følge Holmberg &amp; Andersen (2022) er en collider en tredje variabel som påvikes både avhegig og uavhegige variabelen. Dette skaper en kunstig/spuriøs sammenheng mellom de to opprinnelige variablene, selv om sammenhengen mellom dem ikke er reell. Konsekvensen av collider er falsk assosiasjon mellom de “ekte” variablene. Dette kan påvirke validiteten til observasjonen i et studie.</p>
<p>Valls-Pedret et al.&nbsp;(2015) gjennomførte en RCT som undersøkte om middelhavsdietter hadde en positiv effekt på kognitiv funksjon. De sammenlignet to middelhavsdietter med kognitiv funksjon, med en kontrolldiett hos 447 deltagere med høy kardiovaskulær risiko. Studien fant forbedring i kognitiv funksjon med begge diettene. Frafallet var 33% i kontrollgruppen, og 16 &amp; 23% i middelhavs diettene. Variabelen som da ble “fullført studien” blir en collider fordi den påvirkes av både: Diett-intervensjon (uavhengig variabel) &amp; Kogntiv funksjon (avhengig variabel). Det vil si at dietten deltagerne fikk og deltagernes kognitive funksjon påvirker sannsynligheten for å bli i studien.</p>
<p>Konsekvensen av dette kan være feil i resultatene da dette kan være en overreprestasjon av personene med god kognitiv funksjon , siden de med dårlig kognitiv funksjon ofte falt av dietten. Dette kan bidra til å vise en spuriøs sammenheng mellom diett og kognitiv funksjon.</p>
</section>
<section id="beskriv-ved-hjelp-av-en-grafisk-modell-directed-acyclic-graph-en-positiv-sammenheng-mellom-konsumpsjon-av-sukkerfri-brus-og-diabetes.-begrense-antall-variabler-til-4-og-begrunn-din-modell." class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="beskriv-ved-hjelp-av-en-grafisk-modell-directed-acyclic-graph-en-positiv-sammenheng-mellom-konsumpsjon-av-sukkerfri-brus-og-diabetes.-begrense-antall-variabler-til-4-og-begrunn-din-modell."><span class="header-section-number">7</span> Beskriv ved hjelp av en grafisk modell (Directed Acyclic Graph) en positiv sammenheng mellom konsumpsjon av sukkerfri brus og diabetes. Begrense antall variabler til &lt; 4 og begrunn din modell.</h2>
<p>En directed acyclic graph (DAG) er en type graf som visualiserer kasuale og ikke-kausale sammenhenger mellom ulike variabler. Dette gjøres ved å plotte de ulike variabelene, og deretter bruke piler for å vise årsakssammenhenger (Digitale et al., 2022). Hvis vi ønsker å fremstille den observerte positive <em>sammenhengen</em> mellom konsumpsjon av sukkerfri brus (SF_B) og diabetes mellitus type 2 (DM2), trenger vi følgende:</p>
<ol type="1">
<li><p>En hypotese: En utfallsvariabel (DM2) og en intervensjon (SF_B) som skal påvirke utfallsvariabelen</p></li>
<li><p>De ulike variabelene som kan påvirke både utfallet og intervensjonen (dette inkluderer både ‘confounders’, ‘colliders’ og ’mediators). I dette eksempelet, velger vi én confounder i form av overvekt (OV). Denne variabelen velges fordi overvekt er en risikofaktor for DM2, og folk som er overvektige er dermed oftere diabetikere (Folkehelseinstittet, 2021). Vi har også forskning på at overvektige konsumerer mer sukkerfribrus sammenlignet med normalvektige (Fowler et al., 2015).</p></li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Arbeidskrav4_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Figur 1 illustrerer at vi kan risikere å etablere en spuriøs korrelasjon mellom konsumpsjon av sukkerfribrus og DM2, hvis vi ikke kontrollerer for OV i en hypotetisk modell. Sannsynligvis er årskaen til at vi observerer at flere folk som drikker sukkerfribrus utvikler diabetes, er at de har andre risikofaktorer som overvekt eller genetikk som forårsaker sykdommen.</p>
<p>Ved å illustere alle variabelene med en DAG og kombinere det med kunnskapen vi har om fysiologi og tidligere forskning, kan vi unngå feilaktige konklusjoner.</p>
</section>
<section id="referanseliste" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="referanseliste"><span class="header-section-number">8</span> Referanseliste</h2>
<p>Council, N. R., Medicine, I. of, Board on Children, Youth, Families, Development, C. on I. the S. of E. C., Phillips, D. A., &amp; Shonkoff, J. P. (2000).&nbsp;<em>From Neurons to Neighborhoods: The Science of Early Childhood Development</em>&nbsp;(1st ed.). National Academies Press. <a href="https://doi.org/10.17226/9824" class="uri">https://doi.org/10.17226/9824</a></p>
<p>Digitale, J. C., Martin, J. N., &amp; Glymour, M. M. (2022). Tutorial on directed acyclic graphs. Journal of clinical epidemiology, 142, 264–267. https://doi.org/10.1016/j.jclinepi.2021.08.001</p>
<p>Holmberg, M. J., &amp; Andersen, L. W. (2022). Collider Bias.&nbsp;<em>JAMA</em>,&nbsp;<em>327</em>(13), 1282–1283. https://doi.org/10.1001/jama.2022.1820</p>
<p>Folkehelseinstituttet. (2021, 31. mai). Diabetes i Norge. https://www.fhi.no/nettpub/hin/ikke-smittsomme/diabetes/</p>
<p>Fowler, S. P., Williams, K., &amp; Hazuda, H. P. (2015). Diet soda intake is associated with long-term increases in waist circumference in a biethnic cohort of older adults: the San Antonio Longitudinal Study of Aging. Journal of the American Geriatrics Society, 63(4), 708–715. https://doi.org/10.1111/jgs.13376</p>
<p>Shadish, W. R., Cook, T. D., &amp; Campbell, D. T. (2002). <em>Experimental and quasi-experimental designs for generalized causal inference</em>. Houghton Mifflin.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>